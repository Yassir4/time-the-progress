# Add the SSH private key to a temporary file
echo "-----BEGIN OPENSSH PRIVATE KEY-----
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
AQIDBA==
-----END OPENSSH PRIVATE KEY-----" > /tmp/ssh_key
chmod 600 /tmp/ssh_key
# Start SSH agent and add the key
eval $(ssh-agent -s)
ssh-add /tmp/ssh_key

ssh -o StrictHostKeyChecking=no root@157.245.12.179 << 'EOF'
# Stop the running container
cd time-the-progress
git pull
docker stop time_it_rails || true
# Remove old container
docker rm time_it_rails || true

# Run a new container from a new image
docker run -it -p 80:80 -v ./storage:/rails/storage -e RAILS_MASTER_KEY=${{ secrets.MASTER_KEY }} --name time_it_rails time_it_rails
EOF